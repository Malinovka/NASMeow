;---Functions

; RTC count one second
rtc_sec:
MOV AL,0x00
OUT 0x70,AL
IN AL,0x71
MOV CL,AL
rtc_loop:
MOV AL,0x00
OUT 0x70,AL
IN AL,0x71
CMP CL,AL
JZ rtc_loop
RET

; Random color changer
counter:
PUSH ECX
MOV CL,[loop_count]
INC CL
CMP CL,3
JE color_change
MOV [loop_count],CL
POP ECX
RET

color_change:
PUSH EBX
CALL random_number
AND EBX,7
IMUL EBX,6
ADD EBX,fg_color
PUSH EBX
CALL print_string
CALL random_number
AND EBX,7
IMUL EBX,6
ADD EBX,bg_color
PUSH EBX
CALL print_string
PUSH cat
CALL print_string
XOR CL,CL
MOV [loop_count],CL
POP EBX
POP ECX
RET

random_number:
RDRAND EBX
RET

; Print null terminated string
; EBX String
print_string:
PUSH EBX
PUSH EAX
MOV EBX,[ESP+12]
print_cont:
MOV AL,[EBX]
TEST AL,AL
JZ exit
OUT DX,AL
INC EBX
JMP print_cont
exit:
POP EAX
POP EBX
RET 4

;---Main

global _start
_start:

; Move serial address to DX
MOV DX,0x3F8

; Clear Screen
PUSH clear
CALL print_string

; Set Terminal Formatting
PUSH fg_color
CALL print_string
PUSH bg_color
CALL print_string

; Print Cat
PUSH cat
CALL print_string

; Animation Loop
animate:
PUSH shift_right
CALL print_string
CALL rtc_sec
CALL counter
PUSH shift_left
CALL print_string
CALL rtc_sec
CALL counter
JMP animate

;---Data

; ESC, Clear Screen, ESC, Cursor Position Reset
clear db 0x1B,'[2J',0

; ESC, 'color', FG colors 90-97, BG colors 40-47
;Each color string is 6 bytes including terminating zero
fg_color db 0x1B,'[90m',0,0x1B,'[91m',0,0x1B,'[92m',0,0x1B,'[93m',0,0x1B,'[94m',0,0x1B,'[95m',0,0x1B,'[96m',0,0x1B,'[97m',0
bg_color db 0x1B,'[40m',0,0x1B,'[41m',0,0x1B,'[42m',0,0x1B,'[43m',0,0x1B,'[44m',0,0x1B,'[45m',0,0x1B,'[46m',0,0x1B,'[47m',0
loop_count db 0

cat db 0x1B,'[1;1HMEOW MEOW MEOW MEOW MEOW MEOW MEOW MEOW MEOW',0xA,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x23,0x23,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x23,0x23,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x23,0x20,0x20,0x23,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x23,0x20,0x20,0x23,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x23,0x20,0x20,0x20,0x20,0x23,0x20,0x5c,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x2f,0x20,0x23,0x20,0x20,0x20,0x20,0x23,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x28,0x20,0x20,0x20,0x20,0x20,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x20,0x20,0x20,0x20,0x29,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x28,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x20,0x29,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x28,0x20,0x20,0x20,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x29,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x28,0x20,0x20,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2f,0x20,0x20,0x29,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x28,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x5f,0x5f,0x5f,0x5f,0x2f,0x20,0x40,0x40,0x40,0x40,0x40,0x20,0x20,0x5c,0x20,0x20,0x5f,0x5f,0x5f,0x5f,0x2f,0x20,0x20,0x20,0x29,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x28,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x40,0x40,0x40,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x29,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x40,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x20,0x20,0x20,0x20,0x5c,0x20,0x20,0x20,0x2f,0x20,0x5c,0x20,0x20,0x20,0x2f,0x20,0x20,0x20,0x20,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x5f,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x5f,0x2f,0x20,0x20,0x20,0x5c,0x5f,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5f,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x5f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5f,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5c,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0

; Set coordinates and insert character. Row, Column
; Clear left eyes, insert right eyes
shift_right db 0x1B,'[9;13H',0x20,0x20,0x1B,'[9;29H',0x20,0x20,0x1B,'[10;12H',0x20,0x20,0x20,0x1B,'[10;28H',0x20,0x20,0x20,0x1B,'[11;12H',0x20,0x20,0x20,0x1B,'[11;28H',0x20,0x20,0x20,0x1B,'[12;13H',0x5F,0x5F,0x1B,'[12;29H',0x5F,0x5F,0x1B,'[9;17H',0x24,0x24,0x1B,'[9;33H',0x24,0x24,0x1B,'[10;17H',0x24,0x24,0x24,0x1B,'[10;33H',0x24,0x24,0x24,0x1B,'[11;17H',0x24,0x24,0x24,0x1B,'[11;33H',0x24,0x24,0x24,0x1B,'[12;17H',0x24,0x24,0x1B,'[12;33H',0x24,0x24,0x1B,'[18;44H',0

; Clear right eyes, insert left
shift_left db 0x1B,'[9;17H',0x20,0x20,0x1B,'[9;33H',0x20,0x20,0x1B,'[10;17H',0x20,0x20,0x20,0x1B,'[10;33H',0x20,0x20,0x20,0x1B,'[11;17H',0x20,0x20,0x20,0x1B,'[11;33H',0x20,0x20,0x20,0x1B,'[12;17H',0x5F,0x5F,0x1B,'[12;33H',0x5F,0x5F,0x1B,'[9;13H',0x24,0x24,0x1B,'[9;29H',0x24,0x24,0x1B,'[10;12H',0x24,0x24,0x24,0x1B,'[10;28H',0x24,0x24,0x24,0x1B,'[11;12H',0x24,0x24,0x24,0x1B,'[11;28H',0x24,0x24,0x24,0x1B,'[12;13H',0x24,0x24,0x1B,'[12;29H',0x24,0x24,0x1B,'[18;44H',0
